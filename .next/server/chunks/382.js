"use strict";exports.id=382,exports.ids=[382],exports.modules={33850:(e,t,r)=>{r.d(t,{Z:()=>a});let a=r(38013).MongoClient.connect("mongodb+srv://ismoilibrohimov39:6WvVS30p89ffo3vY@cluster0.hov8jjx.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0",{maxPoolSize:10})},71766:(e,t,r)=>{r.d(t,{KM:()=>eg,Ir:()=>ev,GY:()=>eh,X8:()=>em,Qz:()=>ew,d_:()=>ex,N$:()=>ed,Ox:()=>ep,aj:()=>ef,X6:()=>eP});var a,o=r(38013),s=r(46082),n=r.n(s),c=r(6521),i=r.n(c),l=r(69636);let u=(e,t)=>{localStorage.setItem("auth",JSON.stringify(t)),l.ZP.success(e),el(),S(!0)};var d=r(34716);let p=r(33567).Z.create({baseURL:""}),m=(0,d.GW)(async({name:e,password:t,email:r})=>{try{let{data:a}=await p.post("/api/users/oauth",{name:e,password:t,email:r});return await p.post("/api/users/email",{password:t,email:r}),u("Авторизация выполнена успешно!",a),a.user}catch(e){l.ZP.error(e.message)}}),g=(0,d.GW)(async({name:e,password:t,email:r,isOAuth:a})=>{if(a){await m({email:r,password:t,name:e});return}let{data:o}=await p.post("/api/users/signup",{name:e,password:t,email:r});if(o.warningMessage){l.ZP.error(o.warningMessage);return}return u("Регистрация прошла успешно!",o),o}),h=(0,d.GW)(async({email:e,password:t,isOAuth:r})=>{if(r){await m({email:e,password:t});return}let{data:a}=await p.post("/api/users/login",{email:e,password:t});if(a.warningMessage){l.ZP.error(a.warningMessage);return}return u("Вход выполнен успешно!",a),a}),w=(0,d.GW)(async({jwt:e})=>{let{data:t}=await p.post("/api/users/refresh",{jwt:e});return localStorage.setItem("auth",JSON.stringify(t)),t}),y=(0,d.Fj)(),f=y.createEvent(),x=y.createEvent(),P=y.createEvent(),v=y.createEvent(),S=y.createEvent();y.createStore(!1).on(f,()=>!0).on(x,()=>!1),y.createStore(!1).on(S,(e,t)=>t);let E=y.createStore({}).on(g.done,(e,{result:t})=>t).on(g.fail,(e,{error:t})=>{l.ZP.error(t.message)}).on(h.done,(e,{result:t})=>t).on(h.fail,(e,{error:t})=>{l.ZP.error(t.message)});(0,d.UP)({clock:P,source:E,fn:(e,{name:t,email:r,password:a,isOAuth:o})=>({name:t,password:a,email:r,isOAuth:o}),target:g}),(0,d.UP)({clock:v,source:E,fn:(e,{email:t,password:r,isOAuth:a,name:o})=>({email:t,password:r,isOAuth:a,name:o}),target:h}),function(e){e.INVALID_JWT_TOKEN="JsonWebTokenError",e.EXPIRED_JWT_TOKEN="TokenExpiredError"}(a||(a={}));let k=(0,d.GW)(async({jwt:e})=>{try{let{data:t}=await p.get("/api/users/login-check",{headers:{Authorization:`Bearer ${e}`}});if(t?.error){C(t.error.name,{repeatRequestMethodName:"loginCheckFx"});return}return S(!0),t.user}catch(e){l.ZP.error(e.message)}}),j=(0,d.Fj)(),I=j.createEvent(),N=j.createStore({}).on(k.done,(e,{result:t})=>t);(0,d.UP)({clock:I,source:N,fn:(e,{jwt:t})=>({jwt:t}),target:k});let C=async(e,t)=>{if(e===a.EXPIRED_JWT_TOKEN){let e=JSON.parse(localStorage.getItem("auth")),r=await w({jwt:e.refreshToken});if(t){let{repeatRequestMethodName:e,payload:a}=t;switch(e){case"getCartItemFx":return T({jwt:r.accessToken});case"addProductToCartFx":return F({...a,jwt:r.accessToken});case"addProductFromLSToCartFx":return O({...a,jwt:r.accessToken});case"deleteCartItemFx":return R({...a,jwt:r.accessToken});case"loginCheckFx":await k({jwt:r.accessToken})}}}},T=(0,d.GW)(async({jwt:e})=>{try{let{data:t}=await p.get("/api/cart/all",{headers:{Authorization:`Bearer ${e}`}});if(t?.error)return await C(t.error.name,{repeatRequestMethodName:"getCartItemsFx"});return t}catch(e){l.ZP.error(e.message)}}),F=(0,d.GW)(async({jwt:e,setSpinner:t,...r})=>{try{t(!0);let{data:a}=await p.post("/api/cart/add",r,{headers:{Authorization:`Bearer ${e}`}});if(a?.error)return await C(a.error.name,{repeatRequestMethodName:"addProductToCartFx",payload:{...r,setSpinner:t}});return l.ZP.success("Добавлено в корзину!"),a}catch(e){l.ZP.error(e.message)}finally{t(!1)}}),M=(0,d.GW)(async({jwt:e,id:t,setSpinner:r,count:a})=>{try{r(!0);let{data:o}=await p.patch(`/api/cart/count?id=${t}`,{count:a},{headers:{Authorization:`Bearer ${e}`}});if(o?.error)return await C(o.error.name,{repeatRequestMethodName:"updateCartItemCountFx",payload:{id:t,setSpinner:r,count:a}});return o}catch(e){l.ZP.error(e.message)}finally{r(!1)}}),R=(0,d.GW)(async({jwt:e,id:t,setSpinner:r})=>{try{r(!0);let{data:a}=await p.delete(`/api/cart/delete?id=${t}`,{headers:{Authorization:`Bearer ${e}`}});if(a?.error)return await C(a.error.name,{repeatRequestMethodName:"deleteCartItemFx",payload:{id:t,setSpinner:r}});return l.ZP.success("Удалено из корзины!"),a}catch(e){l.ZP.error(e.message)}finally{r(!1)}}),O=(0,d.GW)(async({jwt:e,cartItems:t})=>{try{let{data:r}=await p.post("/api/cart/add-many",{items:t},{headers:{Authorization:`Bearer ${e}`}});if(r?.error)return await C(r.error.name,{repeatRequestMethodName:"addProductsFromLSToCartFx",payload:{items:t}});return W({jwt:e}),r}catch(e){l.ZP.error(e.message)}}),U=(0,d.Fj)(),W=U.createEvent(),Z=U.createEvent(),b=U.createEvent(),_=U.createEvent(),z=U.createEvent(),G=U.createEvent(),$=U.createEvent(),q=U.createEvent(),A=U.createStore([]).on(T.done,(e,{result:t})=>t).on(O.done,(e,{result:t})=>t.items).on(F.done,(e,{result:t})=>[...new Map([...e,t.newCartItem].map(e=>[e.clientId,e])).values()]).on(M.done,(e,{result:t})=>e.map(e=>e._id===t.id?{...e,count:t.count}:e)).on(R.done,(e,{result:t})=>e.filter(e=>e._id!==t.id));U.createStore([]).on(Z,(e,t)=>t),U.createStore(0).on(G,(e,t)=>t),U.createStore(!1).on(q,(e,t)=>t),(0,d.UP)({clock:W,source:A,fn:(e,t)=>t,target:T}),(0,d.UP)({clock:b,source:A,fn:(e,t)=>t,target:F}),(0,d.UP)({clock:_,source:A,fn:(e,t)=>t,target:O}),(0,d.UP)({clock:z,source:A,fn:(e,t)=>t,target:M}),(0,d.UP)({clock:$,source:A,fn:(e,t)=>t,target:R});var D=r(86843);let B=(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts`),{__esModule:J,$$typeof:L}=B;B.default,(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#MainPageGate`),(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#setCurrentProduct`),(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#loadOneProduct`),(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#$newProducts`),(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#$bestsellerProducts`),(0,D.createProxy)(String.raw`C:\Users\hp\Desktop\online-shop\context\goods.ts#$currentProduct`);let K=(0,d.Fj)(),X=K.createEvent(),V=K.createEvent(),Y=K.createEvent(),Q=K.createEvent(),H=K.createEvent(),ee=K.createEvent(),et=K.createEvent(),er=K.createEvent(),ea=K.createEvent(),eo=K.createEvent();K.createStore(!1).on(X,()=>!0).on(V,()=>!1),K.createStore(!1).on(Y,()=>!0).on(Q,()=>!1),K.createStore(!1).on(H,()=>!0).on(ee,()=>!1),K.createStore(!1).on(er,()=>!0).on(et,()=>!1),K.createStore(!1).on(ea,()=>!1).on(eo,()=>!0);let es=(0,d.Fj)(),en=es.createEvent();es.createStore({}).on(en,(e,t)=>t);let ec=()=>{document.querySelector("body").classList.remove("overflow-hidden")},ei=e=>{let t=e.length,r;for(;0!=t;)r=Math.floor(Math.random()*t),t--,[e[t],e[r]]=[e[r],e[t]];return e},el=()=>{ec(),x()};var eu=r(98984);let ed=async(e,t)=>{let r=(await e).db("rostelecom-online");return t?{db:r,reqBody:await t.json()}:{db:r}},ep=async(e,t)=>{let r=await e.collection("cloth").find().toArray(),a=await e.collection("accessories").find().toArray();return ei([...r.filter(e=>e[t]&&Object.values(e.sizes).some(e=>e)).slice(0,2),...a.filter(e=>e[t]&&!Object.values(e.sizes).length).slice(0,2)])},em=(e,t)=>({accessToken:n().sign({name:e,email:t},"secureaccesstoken",{expiresIn:"10m"}),refreshToken:n().sign({email:t},"securerefreshtoken",{expiresIn:"30d"})}),eg=async(e,t)=>{let r=i().genSaltSync(10),a=i().hashSync(t.password,r);return await e.collection("users").insertOne({name:t.name,password:a,email:t.email,image:"",role:"user"}),em(t.name,t.email)},eh=async(e,t)=>e.collection("users").findOne({email:t}),ew=async(e,t,r=!0)=>{let{db:a,reqBody:o}=await ed(e,r?t:null),s=t.headers.get("authorization")?.split(" ")[1];return{db:a,reqBody:o,validatedTokenResult:await ey(s),token:s}},ey=async e=>{let t={message:"Unauthorized",status:401},r=null;return e?(await n().verify(e,"secureaccesstoken",async e=>{e&&(r=e)}),r)?{...t,error:r}:{status:200}:{...t,error:{message:"jwt is required"}}},ef=e=>JSON.parse(Buffer.from(e.split(".")[1],"base64").toString()),ex=async(e,t,r)=>{let{db:a,validatedTokenResult:o,token:s}=await ew(e,t,!1);if(200!==o.status)return eu.NextResponse.json(o);let n=await eh(a,ef(s).email),c=await a.collection(r).find({userId:n?._id}).toArray();return eu.NextResponse.json(c)},eP=async(e,t,r)=>{let{db:a,validatedTokenResult:s,reqBody:n,token:c}=await ew(e,t);if(200!==s.status)return eu.NextResponse.json(s);if(!n.items)return eu.NextResponse.json({message:"items fields is required",status:404});let i=await a.collection("users").findOne({email:ef(c).email}),l=n.items.map(e=>({userId:i?._id,...e,productId:new o.ObjectId(e.productId)}));return(await a.collection(r).deleteMany({userId:i?._id}),l.length)?(await a.collection(r).insertMany(l),eu.NextResponse.json({status:201,items:l})):eu.NextResponse.json({status:201,items:[]})},ev=async(e,t,r,a)=>{let{db:s,validatedTokenResult:n}=await ew(e,t,!1);return 200!==n.status?eu.NextResponse.json(n):(await s.collection(a).deleteOne({_id:new o.ObjectId(r)}),eu.NextResponse.json({status:204,id:r}))}}};